---
title: "Datos Espaciales"
format: 
  html:
    grid: 
      body-width: 950px
editor: visual
---

# Introducción

Los datos espaciales son información que contiene una referencia geográfica, es decir, datos que están vinculados a una ubicación específica en la superficie terrestre. En el contexto de R, trabajamos frecuentemente con estos datos para realizar análisis geoespaciales, crear mapas y visualizar patrones espaciales.

# ¿Qué son los archivos Shapefile?

Los archivos **Shapefile** (con extensión `.shp`) son uno de los formatos más comunes para almacenar datos vectoriales geoespaciales. Fueron desarrollados por ESRI y se han convertido en un estándar de facto en la industria GIS.

## Componentes de un Shapefile

Un shapefile no es un archivo único, sino un conjunto de archivos que trabajan juntos:

-   **`.shp`**: Archivo principal que contiene la geometría de las características espaciales
-   **`.shx`**: Archivo de índice que permite acceso rápido a los registros
-   **`.dbf`**: Base de datos en formato dBASE que contiene los atributos
-   **`.prj`**: Archivo de proyección que define el sistema de coordenadas
-   **`.cpg`**: Archivo de codificación de caracteres (opcional)

## Tipos de geometrías

Los shapefiles pueden contener tres tipos principales de geometrías:

1.  **Puntos**: Ubicaciones específicas (coordenadas x, y)
2.  **Líneas**: Secuencias de puntos conectados (ríos, carreteras)
3.  **Polígonos**: Áreas cerradas (límites administrativos, lagos)
4.  **Multipuntos, Multilíneas y Multipolígonos**: Colecciones de los tipos anteriores

# Fuente de datos: INEGI

Para este ejemplo, utilizaremos los datos del **Instituto Nacional de Estadística y Geografía (INEGI)** de México. Específicamente, el Marco Geoestadístico disponible en:

**Enlace de descarga**: https://www.inegi.org.mx/app/biblioteca/ficha.html?upc=794551132173

Este conjunto de datos para el estado de Jalisco incluye: - Límites estatales (archivos `14ent.*`) - Límites municipales (archivos `14mun.*`) - Otras divisiones territoriales

# Configuración del entorno

Primero, carguemos las librerías necesarias:

```{r setup}
#| warning: false
#| message: false

# Cargar librerías
library(tidyverse)    # Para manipulación de datos
library(sf)          # Para datos espaciales
library(viridis)     # Para paletas de colores

# Configurar tema para los mapas
theme_set(theme_minimal())
```

## Lectura de datos espaciales

### Cargando los límites estatales

Primero, leemos el archivo shapefile para Jalisco:

```{r entidades}
# Nota: Asegúrate de que todos los archivos (shp, shx, dbf, prj, cpg) estén en el mismo directorio: data

jalisco_estado <- st_read("data/14ent.shp", options = "ENCODING=LATIN1", quiet = TRUE)
```

### Visualización del estado de Jalisco

```{r mapa_jalisco_estado}
# Crear mapa básico de Jalisco
mapa_jalisco <- ggplot(jalisco_estado) +
  geom_sf(fill = "lightblue", color = "darkblue", size = 0.8) +
  labs(
    title = "Estado de Jalisco",
    subtitle = "Límites estatales",
    caption = "Fuente: INEGI - Marco Geoestadístico"
  ) +
  theme_void() +
  theme(
    plot.title = element_text(size = 16, face = "bold"),
    plot.subtitle = element_text(size = 12),
    plot.caption = element_text(size = 10)
  )

print(mapa_jalisco)
```

## Trabajando con límites municipales

### Cargando los datos municipales

Ahora carguemos los límites municipales:

```{r municipios}
municipios_jalisco <- st_read("data/14mun.shp", options = "ENCODING=LATIN1", quiet = TRUE)

# Explorar los datos
cat("Número de municipios en Jalisco:", nrow(municipios_jalisco), "\n")
cat("Primeros 10 municipios:\n")
print(municipios_jalisco$NOMGEO[1:10])
```

### Visualización de municipios

```{r mapa_municipios}
# Crear mapa de municipios de Jalisco
mapa_municipios <- ggplot(municipios_jalisco) +
  geom_sf(fill = "lightgreen", color = "white", size = 0.3) +
  labs(
    title = "Municipios de Jalisco",
    subtitle = paste("Total de municipios:", nrow(municipios_jalisco)),
    caption = "Fuente: INEGI - Marco Geoestadístico"
  ) +
  theme_void() +
  theme(
    plot.title = element_text(size = 16, face = "bold"),
    plot.subtitle = element_text(size = 12),
    plot.caption = element_text(size = 10)
  )

print(mapa_municipios)
```

### Destacando algunos municipios importantes

```{r municipios_importantes}
# Identificar algunos municipios importantes
municipios_importantes <- c("Guadalajara", "Zapopan", "San Pedro Tlaquepaque", 
                          "Tonalá", "Puerto Vallarta", "Lagos de Moreno")

# Crear una variable para destacar estos municipios
municipios_jalisco <- municipios_jalisco %>%
  mutate(
    importante = case_when(
      NOMGEO %in% municipios_importantes ~ "Importante",
      TRUE ~ "Otros"
    )
  )

# Crear mapa destacando municipios importantes
mapa_destacados <- ggplot(municipios_jalisco) +
  geom_sf(aes(fill = importante), color = "white", size = 0.2) +
  scale_fill_manual(
    values = c("Importante" = "darkblue", "Otros" = "lightblue"),
    name = "Clasificación"
  ) +
  labs(
    title = "Municipios Importantes de Jalisco",
    subtitle = "Se destacan algunos municipios principales",
    caption = "Fuente: INEGI - Marco Geoestadístico"
  ) +
  theme_void() +
  theme(
    plot.title = element_text(size = 16, face = "bold"),
    plot.subtitle = element_text(size = 12),
    plot.caption = element_text(size = 10),
    legend.position = "bottom"
  )

print(mapa_destacados)
```

## Análisis espacial básico

### Calculando áreas

```{r areas}
# Calcular área de cada municipio (en km²)
municipios_jalisco <- municipios_jalisco %>%
  mutate(area_km2 = as.numeric(st_area(.)) / 1e6)  # Convertir m² a km²

# Los 10 municipios más grandes
municipios_grandes <- municipios_jalisco |> 
  st_drop_geometry() |> 
  arrange(desc(area_km2)) |> 
  select(NOMGEO, area_km2) |> 
  head(10)

print("Los 10 municipios más grandes de Jalisco:")
knitr::kable(municipios_grandes, 
             col.names = c("Municipio", "Área (km²)"),
             digits = 2)
```

### Mapa de áreas

```{r mapa_areas}
# Crear mapa coloreado por área
mapa_areas <- ggplot(municipios_jalisco) +
  geom_sf(aes(fill = area_km2), color = "white", size = 0.1) +
  scale_fill_viridis_c(
    name = "Área\n(km²)",
    trans = "log10",
    labels = scales::comma_format()
  ) +
  labs(
    title = "Área de los Municipios de Jalisco",
    subtitle = "Coloreado por área en escala logarítmica",
    caption = "Fuente: INEGI - Marco Geoestadístico"
  ) +
  theme_void() +
  theme(
    plot.title = element_text(size = 16, face = "bold"),
    plot.subtitle = element_text(size = 12),
    plot.caption = element_text(size = 10),
    legend.position = "right"
  )

print(mapa_areas)
```
