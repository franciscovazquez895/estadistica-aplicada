---
title: "Análisis Estadístico de las Finanzas Públicas Estatales en México: Ingresos"
subtitle: "Estadística de Finanzas Públicas Estatales y Municipales (EFIPEM) 2013-2023"
format: 
  html:
    grid: 
      body-width: 1000px
editor: visual
---

```{=html}
<style>
main.content {
text-align: justify}
</style>
```

```{r}
#| code-fold: true
#| message: false
#| warning: false

library(tidyverse)
library(RColorBrewer)
library(sf)          # Para datos espaciales
library(viridis)     # Para paletas de colores
library(DT)
library(plotly)
library(knitr)
library(kableExtra)
library(corrplot)
library(broom)
library(scales)
library(multcomp)
```

# Introducción

El análisis de los ingresos estatales reviste particular importancia en el contexto del federalismo fiscal mexicano, donde la estructura de transferencias intergubernamentales determina en gran medida la capacidad de gestión y provisión de servicios públicos de las entidades federativas. La comprensión detallada de estas fuentes de financiamiento permite evaluar tanto el grado de autonomía fiscal de los estados como su dependencia de los recursos federales.

Este documento presenta el marco conceptual que sustenta la clasificación de los ingresos estatales según la metodología del INEGI, estableciendo las definiciones precisas de cada categoría y subcategoría que conforman el universo de recursos financieros de los gobiernos estatales mexicanos. 
Posteriormente, se realiza un análisis exploratorio de los datos de ingresos estatales disponibles en la EFIPEM para el periodo 2013-2023, utilizando técnicas estadísticas y visualizaciones gráficas para ilustrar las principales tendencias y patrones observados. Considerando los hallazgos preliminares de la exploración de datos, se llevan a cabo algunas pruebas de hipótesis respecto a la distribución de los ingresos.

# Clasificación General de los Ingresos Estatales

Según la metodología establecida por el INEGI en la EFIPEM, los ingresos de los estados mexicanos se organizan en tres grandes categorías que reflejan tanto el origen de los recursos como el grado de autonomía en su gestión:

## Estructura General

| **Categoría Principal** |  **Fuentes Principales** |
|--------------------|:-------------------------|
| **Ingresos Propios** | Impuestos, Derechos, Productos, Aprovechamientos, Contribuciones de Mejoras |
| **Ingresos Federales** | Participaciones Federales, Aportaciones Federales |
| **Resto de Ingresos** | Financiamiento, Disponibilidad Inicial, Otros Ingresos |

### Ingresos Propios

Los ingresos propios representan los recursos que los estados recaudan directamente en ejercicio de sus facultades tributarias y administrativas. Esta categoría incluye:

-   **Impuestos**: Gravámenes establecidos por las legislaturas estatales sobre bases imponibles de competencia local
-   **Derechos**: Contraprestaciones por servicios prestados por la administración pública estatal
-   **Productos**: Ingresos derivados de la explotación de bienes del dominio del estado
-   **Aprovechamientos**: Ingresos diversos no clasificados en las categorías anteriores
-   **Contribuciones de Mejoras**: Cobros por beneficios derivados de obras públicas

### Ingresos Federales

Esta categoría constituye el componente más significativo de los ingresos estatales y se subdivide en:

-   **Participaciones Federales**: Transferencias no condicionadas
-   **Aportaciones Federales**: Transferencias condicionadas a usos específicos

### Resto de Ingresos

Comprende recursos de naturaleza diversa:

-   **Financiamiento**: Recursos obtenidos mediante endeudamiento
-   **Disponibilidad Inicial**: Saldos disponibles del ejercicio anterior
-   **Otros Ingresos**: Recursos extraordinarios y de empresas con participación estatal

# Participaciones Federales

## Naturaleza y Características

Las participaciones federales constituyen **transferencias incondicionales** que el gobierno federal distribuye a las entidades federativas como parte del Sistema Nacional de Coordinación Fiscal. Estos recursos pueden ser ejercidos libremente por los estados según sus propios criterios y prioridades, representando una fuente fundamental de autonomía fiscal relativa.

## Componentes de las Participaciones Federales

### Fondos Participables 

Constituyen el componente más importante y comprenden:

-   **Fondo General de Participaciones**: Principal mecanismo de distribución de recursos federales
-   **Fondo de Fomento Municipal**: Recursos destinados al fortalecimiento de las finanzas municipales
-   **Fondo de Fiscalización**: Incentivos para el fortalecimiento de las administraciones tributarias locales

### Impuestos Participables 

Incluyen la distribución de recursos provenientes de impuestos federales específicos:

-   **Impuesto a la Tenencia Vehicular** (vigente hasta 2011)
-   **Impuesto sobre Automóviles Nuevos**
-   **Impuesto sobre Producción y Servicios**

### Otras Participaciones

Comprenden recursos diversos como:

-   **Multas Administrativas Federales No Fiscales**
-   **Incentivos por Administración de Impuestos Federales**
-   **Otros conceptos participables**

## Importancia en el Federalismo Fiscal

Las participaciones federales constituyen un mecanismo clave del federalismo fiscal mexicano, ya que:

1.  **Garantizan recursos mínimos** a todas las entidades federativas
2.  **Preservan la autonomía** en el destino de los recursos
3.  **Distribuyen la riqueza fiscal** nacional de manera más equitativa
4.  **Simplifican la administración tributaria** al centralizar la recaudación de impuestos principales

# Aportaciones Federales

## Naturaleza y Evolución

Las aportaciones federales representan el componente más importante de los ingresos estatales, constituyendo **transferencias condicionadas** destinadas a usos y objetivos específicos en sectores prioritarios como educación, salud, infraestructura social y seguridad pública.

Su importancia ha crecido de manera notable: mientras que en 1990 representaban apenas el **1%** de los ingresos totales estatales, para 2009 alcanzaron más del **54%**, manteniéndose en 2011 en el **49.3%** del total, con un monto de **676,954 millones de pesos**.

## Estructura de las Aportaciones Federales

### Ramo General 33 

El Ramo 33 constituye el principal mecanismo de transferencias condicionadas y se distribuye en los siguientes sectores:

#### Distribución Sectorial del Ramo 33

| **Sector** | **Descripción** |
|--------------------|:---------------------------|
| **Educación** |  Fondos para educación básica, normal, tecnológica y de adultos |
| **Otros Sectores** | Fortalecimiento municipal, fondos múltiples y aportaciones a municipios |
| **Salud** |  Servicios de salud para población abierta |
| **Infraestructura** | Infraestructura social estatal y municipal |
| **Seguridad Pública** | Seguridad pública estatal y del Distrito Federal |

### Recursos Federales Reasignados 

Comprenden recursos provenientes de:

-   **Convenios para Obras Públicas**: Infraestructura de gran envergadura
-   **Convenios de Educación, Cultura y Deportes**: Programas especiales en estos sectores

## Características Operativas

### Condicionalidad y Destino Específico

Las aportaciones federales se caracterizan por:

1.  **Destino predeterminado**: Cada fondo tiene objetivos específicos establecidos en la legislación federal
2.  **Normatividad estricta**: Su ejercicio está sujeto a lineamientos federales detallados
3.  **Rendición de cuentas**: Requieren informes específicos sobre su aplicación
4.  **Complementariedad**: Deben complementarse con recursos propios o de otras fuentes

### Marco Jurídico

El sistema de aportaciones federales se sustenta en:

-   **Ley de Coordinación Fiscal**: Marco general del federalismo fiscal
-   **Ley Federal de Presupuesto y Responsabilidad Hacendaria**: Normas presupuestales
-   **Lineamientos específicos** emitidos por las dependencias federales coordinadoras

## Impacto en la Gestión Pública Estatal

Las aportaciones federales han transformado significativamente la gestión pública estatal al:

1.  **Garantizar recursos mínimos** para servicios públicos esenciales
2.  **Establecer estándares nacionales** en la prestación de servicios
3.  **Promover la equidad territorial** en el acceso a servicios públicos
4.  **Fortalecer capacidades institucionales** locales

Sin embargo, también han generado:

-   **Rigidez presupuestal** en los gobiernos estatales
-   **Dependencia de criterios federales** para la asignación de recursos
-   **Complejidad administrativa** en el ejercicio de los recursos
-   **Limitación de la autonomía fiscal** estatal



# Cargar datos

Consideramos los datos de finanzas públicas de los estados de México, disponibles en varios archivos CSV dentro de la carpeta "conjunto_de_datos". No se consideran los valores de la Ciudad de México.

```{r}
#| code-fold: true
#| message: false
#| warning: false


# Se identifican los archivos CSV en el directorio especificado
data_sets <- list.files("./conjunto_de_datos", pattern = "*.csv", full.names = TRUE)

# Se leen y combinan los archivos CSV en un solo data frame
datos <- data_sets |> 
  set_names(nm = data_sets) |> 
  map_dfr(read_csv, .id = "source_file")

# Convertir variables de tipo character a factor
datos_factor <- datos |> 
  dplyr::select(where(is.character)) |> 
  names()

datos <- datos |> 
  mutate(across(all_of(datos_factor), as_factor))

# Crear variables adicionales
datos <- datos |> mutate(ANIO_factor = as_factor(ANIO), VALOR_millones = VALOR / 1e6)
datos <- datos |> rename(CVE_ENT = ID_ENTIDAD)

# Cargar datos de estados y unir con el conjunto de datos principal
datos_estado <- read_csv("tc_entidad.csv")
datos_estado <- datos_estado |> mutate(across(everything(), as_factor))
datos_estado$ZONA <- factor(datos_estado$ZONA, levels = c("NORTE", "CENTRO", "SUR"))

datos <- left_join(datos, datos_estado)

# Eliminar columnas no necesarias
datos <- datos |> dplyr::select(-source_file, -PROD_EST, -COBERTURA, -ESTATUS) 







#glimpse(datos)

nacional_estado <- st_read("data_nacional/00ent.shp", options = "ENCODING=LATIN1", quiet = TRUE)
nacional_estado <- left_join(nacional_estado, datos_estado, by = "CVE_ENT")

cat("Años disponibles:", paste(unique(datos$ANIO_factor), collapse = ", "), "\n")
cat("Entidades incluidas:", length(unique(datos$CVE_ENT)), "\n")
cat("Temas:", paste(unique(datos$TEMA), collapse = ", "), "\n")
cat("Categorías:", paste(unique(datos$CATEGORIA), collapse = ", "), "\n\n")

```



# Análisis Exploratorio de Datos: Ingresos Nivel Capítulo

## Estructura General de los Datos

* Dataset `ingresos`: Filtrado para el tema "Ingresos" y categoría "Capítulo". Se agrega porcentaje anual de cada capítulo.
* Dataset `ingresos_agregados`: Agregado por año, estado y categoría principal con cálculos de porcentaje anual.
* Dataset `ingresos_wide`: Transformado a formato ancho con valores y porcentajes por categoría principal.

```{r}
#| code-fold: true

ingresos <- datos |> filter(TEMA == "Ingresos", CATEGORIA == "Capítulo")

# Agregar porcentaje anual al dataset original
ingresos <- ingresos |> 
  group_by(ANIO, CVE_ENT, NOM_ENT) |> 
  mutate(
    total_estado_anio = sum(VALOR_millones, na.rm = TRUE),
    porcentaje_anual = (VALOR_millones / total_estado_anio) * 100
  ) |> 
  ungroup()


niveles_categoria <- c("Aportaciones federales", "Participaciones federales", "Financiamiento", "Impuestos", "Derechos",  "Aprovechamientos", "Productos", "Contribuciones de Mejoras",  "Disponibilidad inicial", "Cuotas y Aportaciones de Seguridad Social", "Otros ingresos")

ingresos$DESCRIPCION_CATEGORIA <- factor(ingresos$DESCRIPCION_CATEGORIA, levels = niveles_categoria)

# Agregar columna de categorías principales
ingresos <- ingresos |> 
  mutate(
    CATEGORIA_PRINCIPAL = case_when(
      # Ingresos Propios
      DESCRIPCION_CATEGORIA %in% c("Impuestos", "Derechos", "Productos", 
                                   "Aprovechamientos", "Contribuciones de Mejoras") ~ "Propios",
      
      # Participaciones Federales
      DESCRIPCION_CATEGORIA == "Participaciones federales" ~ "Participaciones Federales",
      
      # Aportaciones Federales
      DESCRIPCION_CATEGORIA == "Aportaciones federales" ~ "Aportaciones Federales",
      
      # Resto
      DESCRIPCION_CATEGORIA %in% c("Financiamiento", "Disponibilidad inicial", 
                                   "Otros ingresos",
                                   "Cuotas y Aportaciones de Seguridad Social") ~ "Resto",
      
      # Para cualquier categoría no prevista
      TRUE ~ "Otros"
    ),
    
    # Convertir a factor con orden específico
    CATEGORIA_PRINCIPAL = factor(CATEGORIA_PRINCIPAL, 
                                levels = c("Propios", "Participaciones Federales", 
                                          "Aportaciones Federales", "Resto"))
  )




# Agregar datos por ANIO, Estado y CATEGORIA_PRINCIPAL con porcentajes
ingresos_agregados <- ingresos |> 
  group_by(ANIO, CVE_ENT, NOM_ENT, ABR_ENT, ZONA, CATEGORIA_PRINCIPAL, ANIO_factor) |> 
  summarise(
    VALOR = sum(VALOR, na.rm = TRUE),
    VALOR_millones = sum(VALOR_millones, na.rm = TRUE),
    .groups = "drop"
  ) |> 
  # Calcular porcentaje por estado y año
  group_by(ANIO, CVE_ENT, NOM_ENT) |> 
  mutate(
    total_estado_anio = sum(VALOR_millones, na.rm = TRUE),
    porcentaje_anual = (VALOR_millones / total_estado_anio) * 100
  ) |> 
  ungroup() |> 
  # Reordenar columnas para mantener estructura similar
  dplyr::select(
    ANIO,
    CVE_ENT, 
    VALOR,
    ANIO_factor,
    VALOR_millones,
    porcentaje_anual,
    NOM_ENT,
    ABR_ENT,
    ZONA,
    CATEGORIA_PRINCIPAL
  )


# Transformar a formato ancho con valor y porcentaje por categoría
ingresos_wide <- ingresos_agregados |> 
  dplyr::select(ANIO, CVE_ENT, ANIO_factor, NOM_ENT, ABR_ENT, ZONA, 
         CATEGORIA_PRINCIPAL, VALOR_millones, porcentaje_anual) |> 
  pivot_wider(
    names_from = CATEGORIA_PRINCIPAL,
    values_from = c(VALOR_millones, porcentaje_anual),
    names_sep = "_"
  ) |> 
  rename_with(
    ~ case_when(
      .x == "VALOR_millones_Propios" ~ "Propios_valor",
      .x == "porcentaje_anual_Propios" ~ "Propios_porcentaje",
      .x == "VALOR_millones_Participaciones Federales" ~ "Participaciones_Federales_valor",
      .x == "porcentaje_anual_Participaciones Federales" ~ "Participaciones_Federales_porcentaje",
      .x == "VALOR_millones_Aportaciones Federales" ~ "Aportaciones_Federales_valor",
      .x == "porcentaje_anual_Aportaciones Federales" ~ "Aportaciones_Federales_porcentaje",
      .x == "VALOR_millones_Resto" ~ "Resto_valor",
      .x == "porcentaje_anual_Resto" ~ "Resto_porcentaje",
      TRUE ~ .x
    )
  ) |> 
  # Reemplazar NA con 0 donde sea apropiado
  mutate(
    across(contains("_valor"), ~ replace_na(.x, 0)),
    across(contains("_porcentaje"), ~ replace_na(.x, 0))
  ) |> 
  # Reordenar columnas
  dplyr::select(
    ANIO, CVE_ENT, ANIO_factor, NOM_ENT, ABR_ENT, ZONA,
    Propios_valor, Propios_porcentaje,
    Participaciones_Federales_valor, Participaciones_Federales_porcentaje,
    Aportaciones_Federales_valor, Aportaciones_Federales_porcentaje,
    Resto_valor, Resto_porcentaje
  )




cat("Capítulos presentes: ", paste(levels(ingresos$DESCRIPCION_CATEGORIA), collapse = ", \n"))

# Tabla resumen
resumen_estructura <- ingresos |> group_by(TEMA, CATEGORIA, ABR_ENT) |> 
  summarise(
    registros = n(),
    valor_total = sum(VALOR, na.rm = TRUE)/ 1e9,  # En miles de millones
    .groups = "drop"
  ) |> 
  arrange(TEMA, CATEGORIA, ABR_ENT)

kable(resumen_estructura, 
      col.names = c("Tema", "Categoría", "Entidad", "Registros", "Total (Miles Mill. MXN)"),
      digits = 2,
      caption = "Estructura General de Ingresos EFIPEM 2014-2023") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"))
```



### Mapa de Agregado de Ingresos por Estado (2013-2023)

```{r}
#| code-fold: true
#| fig-width: 8
#| fig-height: 6
#| fig-align: "center"

agregado_mapa <- resumen_estructura |> 
  dplyr::select(ABR_ENT, valor_total)
agregado_mapa <- left_join(nacional_estado, agregado_mapa, by = "ABR_ENT")


mapa <- ggplot(agregado_mapa) +
  geom_sf(aes(fill=valor_total), color = "gray50", size = 0.5) +
  labs(
    title = "Ingresos totales por estado (2013-2023)",
    subtitle = "Valores en miles de millones de MXN",
    caption = "Fuente: INEGI - Finanzas Públicas",
    fill = " "
  ) +
  scale_fill_viridis_c(labels = comma) +
  theme_void() +
  theme(
    plot.title = element_text(size = 16, face = "bold"),
    plot.subtitle = element_text(size = 12),
    plot.caption = element_text(size = 10)
  )
  
  
print(mapa)
```

Sin el Estado de México.

```{r}
#| code-fold: true
#| fig-width: 8
#| fig-height: 6
#| fig-align: "center"


mapa <- ggplot(agregado_mapa |> filter(ABR_ENT != "MEX")) +
  geom_sf(aes(fill=valor_total), color = "gray50", size = 0.5) +
  labs(
    title = "Ingresos totales por estado (2013-2023)",
    subtitle = "Valores en miles de millones de MXN",
    caption = "Fuente: INEGI - Finanzas Públicas",
    fill = " "
  ) +
  scale_fill_viridis_c(labels = comma) +
  theme_void() +
  theme(
    plot.title = element_text(size = 16, face = "bold"),
    plot.subtitle = element_text(size = 12),
    plot.caption = element_text(size = 10)
  )
  
  
print(mapa)
```

### Composición de Ingresos por Estado (2013-2023)


```{r}
#| code-fold: true
#| fig-width: 10
#| fig-height: 10
#| fig-align: "center"

# Calcular porcentajes de cada categoría por estado
porcentajes_categoria_estado <- ingresos |> 
  group_by(NOM_ENT, ABR_ENT, DESCRIPCION_CATEGORIA) |> 
  summarise(valor_categoria = sum(VALOR_millones, na.rm = TRUE), .groups = "drop") |> 
  group_by(NOM_ENT, ABR_ENT) |> 
  mutate(
    total_estado = sum(valor_categoria),
    porcentaje = (valor_categoria / total_estado) * 100
  ) %>%
  ungroup()

# Con etiquetas de porcentaje (solo categorías >5%)
graf_bar <- porcentajes_categoria_estado |> 
  mutate(etiqueta = ifelse(porcentaje >= 5, 
                          paste0(round(porcentaje, 1), "%"), 
                          "")) |> 
  ggplot(aes(x = reorder(ABR_ENT, total_estado), 
             y = porcentaje, 
             fill = DESCRIPCION_CATEGORIA)) +
  geom_col(position = "stack") +
  geom_text(aes(label = etiqueta), 
            position = position_stack(vjust = 0.5),
            size = 4, 
            color = "white",
            fontface = "bold") +
  coord_flip() +
  scale_fill_viridis_d(option = "turbo") +
  labs(
    title = "Composición de Ingresos por Estado",
    subtitle = "Porcentaje por categoría (etiquetas >5%)",
    x = "Estado",
    y = "Porcentaje (%)",
    fill = "Categoría"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 16, face = "bold"),
    plot.subtitle = element_text(size = 12),
    legend.position = "bottom",
    legend.text = element_text(size = 10),
    axis.title.x = element_text(size = 12),
    axis.title.y = element_text(size = 12),
    axis.text.x = element_text(size = 11),
    axis.text.y = element_text(size = 11)
  ) +
  guides(fill = guide_legend(nrow = 3, byrow = TRUE))

graf_bar




```



### Mapa aportaciones federales por estado (2013-2023)


```{r}
#| code-fold: true
#| fig-width: 8
#| fig-height: 6
#| fig-align: "center"
#| message: false

aportaciones_mapa <- porcentajes_categoria_estado |> 
  filter(DESCRIPCION_CATEGORIA == "Aportaciones federales") 

aportaciones_mapa <- left_join(nacional_estado, aportaciones_mapa)


mapa_aportaciones <- ggplot(aportaciones_mapa) +
  geom_sf(aes(fill=valor_categoria), color = "gray50", size = 0.5) +
  labs(
    title = "Aportaciones Federales en Ingresos Totales (2013-2023)",
    subtitle = "En millones de MXN",
    caption = "Fuente: INEGI - Finanzas Públicas",
    fill = "A. Federales"
  ) +
  scale_fill_viridis_c() +
  theme_void() +
  theme(
    plot.title = element_text(size = 16, face = "bold"),
    plot.subtitle = element_text(size = 12),
    plot.caption = element_text(size = 10)
  )

mapa_aportaciones
```

Sin el Estado de México.

```{r}
#| code-fold: true
#| fig-width: 8
#| fig-height: 6
#| fig-align: "center"

mapa_aportaciones <- ggplot(aportaciones_mapa |> filter(ABR_ENT != "MEX")) +
  geom_sf(aes(fill=valor_categoria), color = "gray50", size = 0.5) +
  labs(
    title = "Aportaciones Federales en Ingresos Totales (2013-2023)",
    subtitle = "En millones de MXN",
    caption = "Fuente: INEGI - Finanzas Públicas",
    fill = "A. Federales"
  ) +
  scale_fill_viridis_c() +
  theme_void() +
  theme(
    plot.title = element_text(size = 16, face = "bold"),
    plot.subtitle = element_text(size = 12),
    plot.caption = element_text(size = 10)
  )

mapa_aportaciones
```


```{r}
#| code-fold: true
#| fig-width: 8
#| fig-height: 6
#| fig-align: "center"

mapa_aportaciones <- ggplot(aportaciones_mapa) +
  geom_sf(aes(fill=porcentaje), color = "gray50", size = 0.5) +
  labs(
    title = "Aportaciones Federales en Ingresos Totales (2013-2023)",
    subtitle = "Porcentaje del total de ingresos",
    caption = "Fuente: INEGI - Finanzas Públicas",
    fill = "A. Federales"
  ) +
  scale_fill_viridis_c(labels = percent_format(scale = 1)) +
  theme_void() +
  theme(
    plot.title = element_text(size = 16, face = "bold"),
    plot.subtitle = element_text(size = 12),
    plot.caption = element_text(size = 10)
  )

mapa_aportaciones
```





# Ingresos por Categoría Principal (2013-2023)




```{r}
#| code-fold: true

# 1. Tabla con valores y porcentajes por CATEGORIA_PRINCIPAL
tabla_resumen_principal <- ingresos |> 
  group_by(CATEGORIA_PRINCIPAL) |> 
  summarise(
    valor_millones = sum(VALOR_millones, na.rm = TRUE),
    .groups = "drop"
  ) |> 
  mutate(
    porcentaje = (valor_millones / sum(valor_millones)) * 100,
    valor_billones = valor_millones / 1000000
  ) |> 
  arrange(desc(valor_millones))

# Mostrar tabla formateada
tabla_resumen_principal %>%
  mutate(
    `Valor (Millones MXN)` = format(round(valor_millones, 0), big.mark = ",", scientific = FALSE),
    `Valor (Billones MXN)` = format(round(valor_billones, 2), nsmall = 2),
    `Porcentaje (%)` = format(round(porcentaje, 1), nsmall = 1)
  ) %>%
  dplyr::select(
    `Categoría Principal` = CATEGORIA_PRINCIPAL,
    `Valor (Millones MXN)`,
    `Valor (Billones MXN)`,
    `Porcentaje (%)`
  ) %>%
  kable(
    caption = "Ingresos Estatales por Categoría Principal (2014-2023)",
    align = c("l", "r", "r", "r")
  ) %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed", "responsive"),
    full_width = FALSE,
    font_size = 12
  ) %>%
  add_header_above(c(" " = 1, "Valores Absolutos" = 2, "Relativo" = 1))


```




## Tendencias Temporales por Categoría Principal

A continuación, se presentan las tendencias temporales de los ingresos estatales desglosados por categoría principal para el periodo 2013-2023.

::: {.panel-tabset}


### Ingresos Propios

```{r}
#| code-fold: true

graf_temp <- ggplot(ingresos_agregados |> filter(CATEGORIA_PRINCIPAL == "Propios"), 
                    aes(x = ANIO, y = VALOR_millones, color = ABR_ENT)) +
  geom_line(size = 1.2) +
  geom_point(size = 2) +
  scale_y_continuous(labels = comma) +
  scale_x_continuous(breaks = unique(ingresos_agregados$ANIO)) +
  labs(
    title = "Tendencias Temporales de Ingresos Estatales de la categoría Propios (2013-2023)",
    x = "Año",
    y = "Ingresos (Millones MXN)",
    color = "Estado"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 14, face = "bold"),
    plot.subtitle = element_text(size = 12),
    legend.position = "bottom",
    legend.text = element_text(size = 10),
    axis.title.x = element_text(size = 12),
    axis.title.y = element_text(size = 12),
    axis.text.x = element_text(size = 11),
    axis.text.y = element_text(size = 11)
  )

ggplotly(graf_temp)

```



### Aportaciones Federales


### Participaciones Federales


### Resto de Ingresos



:::



## Composición de Ingresos 


::: {.panel-tabset}

### Guanajuato


```{r}
#| code-fold: true
#| fig-width: 10
#| fig-height: 7
#| fig-align: "center"
  
ggplot(ingresos_agregados |> filter(ABR_ENT =="GTO"), aes(x = ANIO_factor, y =porcentaje_anual,
       fill = CATEGORIA_PRINCIPAL)) +
  geom_col(position = "stack") +
  geom_text(aes(label = ifelse(porcentaje_anual >= 5, paste0(round(porcentaje_anual, 1), "%"), "")), 
            position = position_stack(vjust = 0.5),
            size = 4, 
            color = "white",
            fontface = "bold") +
  coord_flip() +
  scale_fill_viridis_d(option = "turbo") +
  labs(
    title = "Composición de Ingresos de Guanajuato (2013-2023)",
    subtitle = "Porcentaje por categoría (etiquetas >5%)",
    x = "Año",
    y = "Porcentaje (%)",
    fill = "Categoría"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 16, face = "bold"),
    plot.subtitle = element_text(size = 12),
    legend.position = "bottom",
    legend.text = element_text(size = 10),
    axis.title.x = element_text(size = 12),
    axis.title.y = element_text(size = 12),
    axis.text.x = element_text(size = 11),
    axis.text.y = element_text(size = 11)
  ) +
  guides(fill = guide_legend(nrow = 3, byrow = TRUE))

```

### Jalisco

```{r}
#| code-fold: true
#| fig-width: 10
#| fig-height: 7
#| fig-align: "center"

ggplot(ingresos_agregados |> filter(ABR_ENT =="JAL"), aes(x = ANIO_factor, y =porcentaje_anual,
       fill = CATEGORIA_PRINCIPAL)) +
  geom_col(position = "stack") +
  geom_text(aes(label = ifelse(porcentaje_anual >= 5, paste0(round(porcentaje_anual, 1), "%"), "")), 
            position = position_stack(vjust = 0.5),
            size = 4, 
            color = "white",
            fontface = "bold") +
  coord_flip() +
  scale_fill_viridis_d(option = "turbo") +
  labs(
    title = "Composición de Ingresos de Jalisco (2013-2023)",
    subtitle = "Porcentaje por categoría (etiquetas >5%)",
    x = "Año",
    y = "Porcentaje (%)",
    fill = "Categoría"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 16, face = "bold"),
    plot.subtitle = element_text(size = 12),
    legend.position = "bottom",
    legend.text = element_text(size = 10),
    axis.title.x = element_text(size = 12),
    axis.title.y = element_text(size = 12),
    axis.text.x = element_text(size = 11),
    axis.text.y = element_text(size = 11)
  ) +
  guides(fill = guide_legend(nrow = 3, byrow = TRUE))


```

:::



# Aportaciones Federales

A continuación, se presenta un análisis detallado de las Aportaciones Federales como componente clave de los ingresos estatales en México durante el periodo 2013-2023.Inicialmente se muestra por medio de diagramas de cajas la distribución en cada estado de los porcentajes anuales de esta categoría.

```{r}
#| code-fold: true
#| fig-width: 10
#| fig-height: 7
#| fig-align: "center"

ggplot(ingresos_agregados |> filter(CATEGORIA_PRINCIPAL =="Aportaciones Federales"), aes(x = reorder(ABR_ENT, porcentaje_anual, FUN = mean), y =porcentaje_anual,
       fill = ABR_ENT)) +
  geom_boxplot() +
  scale_fill_viridis_d(option = "turbo") +
  labs(
    title = "Distribución de Aportaciones Federales como Porcentaje de Ingresos Totales (2013-2023)",
    subtitle = "Porcentaje por estado",
    x = "Estado",
    y = "Porcentaje (%)",
    fill = "Estado"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 16, face = "bold"),
    plot.subtitle = element_text(size = 12),
    legend.position = "none",
    axis.title.x = element_text(size = 12),
    axis.title.y = element_text(size = 12),
    axis.text.x = element_text(size = 11),
    axis.text.y = element_text(size = 11)
  )


```


Se realiza el análisis de varianza (ANOVA) para determinar si existen diferencias significativas en la media de los porcentajes anuales para esta categoría. 

```{r}
#| code-fold: true
#| fig-width: 12
#| fig-height: 6
#| fig-align: "center"

af_estado_aov <- aov(porcentaje_anual ~ ABR_ENT, data = ingresos_agregados |> filter(CATEGORIA_PRINCIPAL =="Aportaciones Federales"))
```

# Matriz de Correlación entre Categorías de Ingresos

```{r}
#| code-fold: true
#| fig-width: 12
#| fig-height: 6
#| fig-align: "center"

# Seleccionar solo las columnas numéricas para correlación
variables_correlacion <- ingresos_wide %>%
  dplyr::select(
    ANIO,
    Propios_valor, Propios_porcentaje,
    Participaciones_Federales_valor, Participaciones_Federales_porcentaje,
    Aportaciones_Federales_valor, Aportaciones_Federales_porcentaje,
    Resto_valor, Resto_porcentaje
  )

# Calcular matriz de correlación
matriz_correlacion <- cor(variables_correlacion, use = "complete.obs")

corrplot(matriz_correlacion, 
         method = "color",
         type = "upper",
         order = "hclust",
         tl.col = "black",
         tl.srt = 45,
         tl.cex = 0.8,
         addCoef.col = "black",
         number.cex = 0.7,
         title = "Matriz de Correlación - Ingresos Estatales",
         mar = c(0,0,2,0))


```


